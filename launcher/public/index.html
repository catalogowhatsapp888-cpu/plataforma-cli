<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinica AI - Launcher Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: #e5e5e5; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    </style>
</head>
<body class="flex items-center justify-center h-screen bg-black selection:bg-purple-500 selection:text-white">
    <div class="bg-neutral-900 border border-neutral-800 p-8 rounded-3xl shadow-2xl w-full max-w-sm text-center relative overflow-hidden">
        
        <!-- Background Glow -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 bg-purple-600/20 blur-3xl rounded-full pointer-events-none"></div>

        <div class="relative z-10 mb-8">
            <div class="w-20 h-20 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-2xl flex items-center justify-center font-bold text-3xl text-white mx-auto mb-5 shadow-lg shadow-purple-900/40">
                PC
            </div>
            <h1 class="text-xl font-bold text-white tracking-tight">Plataforma Clinica</h1>
            <p class="text-neutral-500 text-xs font-medium uppercase tracking-wider mt-1">Ambiente Local</p>
        </div>

        <div id="status-container" class="py-4 bg-neutral-950 rounded-2xl border border-neutral-800 flex items-center justify-center gap-3 mb-8 transition-colors duration-500">
             <div id="status-dot" class="w-2.5 h-2.5 rounded-full bg-red-500 transition-all duration-500"></div>
             <span id="status-text" class="font-mono text-[10px] uppercase tracking-[0.2em] text-neutral-500 transition-colors duration-500">OFFLINE</span>
        </div>

        <div class="space-y-3 relative z-10">
            <button id="btn-start" onclick="startApp()" class="group w-full py-4 rounded-xl bg-white hover:bg-neutral-200 text-black font-bold transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 disabled:opacity-30 disabled:hover:translate-y-0 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-power"><path d="M12 2v10"/><path d="M18.4 6.6a9 9 0 1 1-12.77.04"/></svg>
                INICIAR SISTEMA
            </button>
            
            <button id="btn-stop" onclick="stopApp()" class="group w-full py-4 rounded-xl bg-neutral-800 hover:bg-red-500/10 hover:text-red-400 hover:border-red-500/30 text-neutral-400 border border-neutral-700 transition-all font-bold disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square"><rect width="18" height="18" x="3" y="3" rx="2"/></svg>
                PARAR TUDO
            </button>
        </div>

        <div class="mt-8 pt-6 border-t border-neutral-800/50 grid grid-cols-2 gap-2">
             <a href="http://localhost:3000" target="_blank" class="flex flex-col items-center justify-center p-3 rounded-xl bg-neutral-800/50 hover:bg-neutral-800 transition text-neutral-400 hover:text-white border border-transparent hover:border-neutral-700">
                <span class="text-xs font-bold mb-1">Frontend</span>
                <span class="text-[10px] opacity-50 font-mono">:3000</span>
             </a>
             <a href="http://localhost:8000/docs" target="_blank" class="flex flex-col items-center justify-center p-3 rounded-xl bg-neutral-800/50 hover:bg-neutral-800 transition text-neutral-400 hover:text-white border border-transparent hover:border-neutral-700">
                <span class="text-xs font-bold mb-1">Backend</span>
                <span class="text-[10px] opacity-50 font-mono">:8000</span>
             </a>
        </div>
    </div>

    <script>
        const API = 'http://localhost:3001/api';
        let isProcessing = false;
        
        async function checkStatus() {
            if(isProcessing) return;
            try {
                const res = await fetch(`${API}/status`);
                const data = await res.json();
                updateUI(data.running);
            } catch (e) {
                updateUI(false); // Assume offline/parado se falhar
            }
        }

        function updateUI(running) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            const container = document.getElementById('status-container');
            const btnStart = document.getElementById('btn-start');
            const btnStop = document.getElementById('btn-stop');

            if (running) {
                dot.className = "w-2.5 h-2.5 rounded-full bg-green-400 shadow-[0_0_12px_rgba(74,222,128,0.8)] animate-pulse";
                text.innerText = "ONLINE";
                text.className = "font-mono text-[10px] uppercase tracking-[0.2em] text-green-400 font-bold";
                container.className = "py-4 bg-green-950/20 border border-green-900/30 rounded-2xl flex items-center justify-center gap-3 mb-8 transition-colors duration-500";
                
                btnStart.disabled = true;
                btnStop.disabled = false;
            } else {
                dot.className = "w-2.5 h-2.5 rounded-full bg-neutral-600";
                text.innerText = "PARADO";
                text.className = "font-mono text-[10px] uppercase tracking-[0.2em] text-neutral-500 font-bold";
                container.className = "py-4 bg-neutral-950 border border-neutral-800 rounded-2xl flex items-center justify-center gap-3 mb-8 transition-colors duration-500";

                btnStart.disabled = false;
                btnStop.disabled = true;
            }
        }

        async function startApp() {
            isProcessing = true;
            document.body.style.cursor = 'wait';
            
            // UI Feedback Imediato
            const dot = document.getElementById('status-dot');
            dot.className = "w-2.5 h-2.5 rounded-full bg-yellow-400 animate-ping";
            document.getElementById('status-text').innerText = "INICIANDO...";
            document.getElementById('status-text').className = "text-yellow-400 font-mono text-[10px] uppercase tracking-[0.2em]";

            try {
                await fetch(`${API}/start`, { method: 'POST' });
                // Delay para dar tempo de criar PID file
                setTimeout(() => {
                    isProcessing = false;
                    document.body.style.cursor = 'default';
                    checkStatus();
                }, 4000);
            } catch (e) {
                alert("Erro ao iniciar launcher.");
                isProcessing = false;
            }
        }

        async function stopApp() {
            isProcessing = true;
            document.body.style.cursor = 'wait';
            try {
                await fetch(`${API}/stop`, { method: 'POST' });
                setTimeout(() => {
                    isProcessing = false;
                    document.body.style.cursor = 'default';
                    checkStatus();
                }, 2000);
            } catch (e) {
                alert("Erro ao parar.");
                isProcessing = false;
            }
        }

        setInterval(checkStatus, 2000);
        checkStatus();
    </script>
</body>
</html>
